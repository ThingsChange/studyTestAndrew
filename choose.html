<!DOCTYPE html>
<HTML>
<HEAD>
    <TITLE> ZTREE DEMO - checkbox select menu</TITLE>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../../css/demo.css" type="text/css">
    <link rel="stylesheet" href="../../css/zTreeStyle.css" type="text/css">
    <script type="text/javascript" src="../../lib/jquery/jquery-1.4.4.min.js"></script>
    <script type="text/javascript" src="../../lib/ztree/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="../../lib/ztree/jquery.ztree.excheck.js"></script>

    <!--	<script type="text/javascript" src="../../../js/jquery.ztree.exedit.js"></script>-->
    <SCRIPT type="text/javascript">
        $(document).ready(function (){
            showMenu();
        });

        var setting = {
            check: {
                enable: true,
                chkStyle:"checkbox",
                chkboxType: {"Y":"", "N":""}
            },
            view: {
                dblClickExpand: false
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeClick: beforeClick,
                onCheck: onCheck
            }
        };

        var zNodes =[
            {id:"A", pId:0, name:"亚洲",open:true, nocheck:true},
            {id:"U", pId:0, name:"欧洲",open:true, nocheck:true},
            {id:"AZ", pId:"A", name:"中国",open:true,nocheck:true},
            {id:"AH", pId:"A", name:"韩国",open:true,nocheck:true},
            {id:"AH1", pId:"AH", name:"首尔",open:true},
            {id:"AZ1", pId:"AZ", name:"北京",open:true},
            {id:"AZ11", pId:"AZ1", name:"北京市"},
            {id:"AZ2", pId:"AZ", name:"天津",open:true},
            {id:"AZ21", pId:"AZ2", name:"天津市"},
            {id:"AZ3", pId:"AZ", name:"上海",open:true},
            {id:"AZ31", pId:"AZ3", name:"上海市"},

            {id:"AZ4", pId:"AZ", name:"河北省",open:false},
            {id:"AZ41", pId:"AZ4", name:"石家庄"},
            {id:"AZ42", pId:"AZ4", name:"保定市"},
            {id:"AZ43", pId:"AZ4", name:"邯郸市"},
            {id:"AZ44", pId:"AZ4", name:"霸州"},
            {id:"AZ45", pId:"AZ4", name:"承德"},

            {id:"AZ5", pId:"AZ", name:"河南省",open:false},
            {id:"AZ51", pId:"AZ5", name:"郑州市"},
            {id:"AZ52", pId:"AZ5", name:"开封市"},
            {id:"AZ53", pId:"AZ5", name:"洛阳市"},
            {id:"AZ54", pId:"AZ5", name:"新乡市"},

            {id:"AZ6", pId:"AZ", name:"广东省",open:false},
            {id:"AZ61", pId:"AZ6", name:"广州市"},
            {id:"AZ62", pId:"AZ6", name:"深圳市"},
            {id:"AZ63", pId:"AZ6", name:"东莞市"},
            {id:"AZ64", pId:"AZ6", name:"佛山市"},

            {id:"AZ7", pId:"AZ", name:"福建省",open:false},
            {id:"AZ71", pId:"AZ7", name:"福州市"},
            {id:"AZ72", pId:"AZ7", name:"厦门市"},
            {id:"AZ73", pId:"AZ7", name:"泉州市"},
            {id:"AZ74", pId:"AZ7", name:"三明市"},

            {id:"U1", pId:"U", name:"法国",open:true, nocheck:true},
            {id:"U11", pId:"U1", name:"巴黎",open:true, nocheck:true},
            {id:"U111", pId:"U11", name:"埃萨尔比亚"}

        ];

        function beforeClick(treeId, treeNode) {
            var zTree = $.fn.zTree.getZTreeObj("treeDemo");
            zTree.checkNode(treeNode, !treeNode.checked, null, true);
            return false;
        }

        function onCheck(e, treeId, treeNode) {


            var zTree = $.fn.zTree.getZTreeObj("treeDemo"),

                    nodes = zTree.getCheckedNodes(true),
                    v = "";
            for (var i=0, l=nodes.length; i<l; i++) {
                v += nodes[i].name + ",";
            }
            if (v.length > 0 ) v = v.substring(0, v.length-1);
            var cityResult=$("#cityRes");
            var result= v.split(",");
            var ul=document.getElementById('cityRes');
            var li=ul.childNodes;
            var a=[];
            for(var i=0;i<li.length;i++){
               console.log(li.item(i).innerHTML);
                a[i]=li.item(i).innerHTML;
            }
            console.log("a="+a);
            var arr3=[];

            (function test(){
                for(var i=0; i < result.length; i++){
                    var flag = true;
                    for(var j=0; j < a.length; j++){
                        if(result[i] == a[j])
                            flag = false;
                    }
                    if(flag)
                        arr3.push(result[i]);
                }
            })();

            $.each(arr3,function(i,v){
                cityResult.append('<li class="x" value="'+v+'">'+v+'</li>');
            })
        }
        function showMenu() {
            var cityObj = $("#citySel");
            var cityOffset = $("#citySel").offset();
            $("#menuContent").css({left:cityOffset.left + "px", top:cityOffset.top + cityObj.outerHeight() + "px"}).slideDown("fast");

            $("body").bind("mousedown", onBodyDown);
        }
     /*   function hideMenu() {
            $("#menuContent").fadeOut("fast");
            $("body").unbind("mousedown", onBodyDown);
        }*/
        function onBodyDown(event) {
            if (!(event.target.id == "menuBtn" || event.target.id == "citySel" || event.target.id == "menuContent" || $(event.target).parents("#menuContent").length>0)) {
                hideMenu();
            }
        }
        $(document).ready(function(){
            $.fn.zTree.init($("#treeDemo"), setting, zNodes);
        });
        //-->
    </SCRIPT>
    <style type="text/css">
    </style>
</HEAD>

<BODY>
<h1>请选择目的地</h1>

<div class="content_wrap">
    <div class="zTreeDemoBackground left">
        <ul class="list">

            <li class="title">&nbsp;&nbsp;Test: <input id="citySel" type="text"  onclick="showMenu()"; readonly value="" style="width:120px;"  />
                &nbsp;<a id="menuBtn" href="#" onclick="showMenu(); return false;">select</a></li>
        </ul>
    </div>

    <div class="right">
        <table width="300px;">
            <tr>
                <td style="margin-left: 130px;">已选目的地</td>
                <td style="float: right">删除</td>
            </tr>

        </table>
        <ul class="info">
            <li class="title">
                <ul id="cityRes"></ul>
            </li>
        </ul>
    </div>
</div>

<div id="menuContent" class="menuContent" style="display:none; position: absolute;">
    <ul id="treeDemo" class="ztree" style="margin-top:0; width:180px; height: 300px;"></ul>
</div>
<div>
    <table>
        <tr>
            <td>
                <input type="button" value="确定" onclick="doSubmit()">
            </td>
            <td>
                <input type="button" value="取消">
            </td>

        </tr>

    </table>
<script>
    function doSubmit(){
        var ul=document.getElementById('cityRes');
        var li=ul.childNodes;
        var a=[];
        for(var i=0;i<li.length;i++){
            console.log(li.item(i).innerHTML);
            a[i]=li.item(i).innerHTML;
        }
        console.log("a==========="+a);
       window.opener.document.getElementById('TestFileName').value=a;
        window.opener.document.getElementById('TestFileName1').innerHTML+=a;
        console.log("1234");
        self.close();
       // closewindow(a);
    }
    function closewindow(a)
    {
        var filename =a;
        console.log(window.opener.document.form1.TestFileName);
        window.opener.document.form1.TestFileName.value = filename;
        alert(filename);
        self.close();
    }
</script>
</div>
</BODY>
</HTML>